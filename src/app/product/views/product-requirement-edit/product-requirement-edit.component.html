<div class="my-4 mx-3 bg-white">
  <nz-card [nzNoHovering]="true">
    <ng-template #title>
      <span class="badge badge-dark">{{requirement.id}}</span>
      <a [routerLink]="['../', 'view']">{{requirement.name}}</a>
      <span class="mx-2"><i class="fa fa-angle-right"></i></span>
      <span>编辑</span>
    </ng-template>
    <ng-template #extra>
      <button type="button" class="btn btn-primary">保存</button>
    </ng-template>
    <ng-template #body>
      <div class="row">
        <div class="col- order-2" style="width: 360px;">
          <div class="card">
            <div class="card-body">
              <h5 class="mb-2">基本信息</h5>

              <form nz-form [formGroup]="requirementForm" [nzLayout]="'horizontal'">
                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="product.id" nz-form-item-required>所属产品</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                    <pms-product-select formControlName="product.id"></pms-product-select>
                  </div>
                </div>

                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="module.id">所属模块</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                    <pms-module-select formControlName="module.id"  [productId]="product.id"></pms-module-select>
                  </div>
                </div>

                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="plan.id">所属计划</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                    <pms-plan-select formControlName="plan.id"  [productId]="product.id"></pms-plan-select>
                  </div>
                </div>

                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="source">需求来源</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                      <pms-attribute-select formControlName="source" group="requirement" code="source"></pms-attribute-select>
                  </div>
                </div>

                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="sourceRemark">来源备注</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                    <nz-input formControlName="sourceRemark" [nzPlaceHolder]="'需求来源说明'"></nz-input>
                  </div>
                </div>

                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="status">当前状态</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                    <nz-input formControlName="status" [nzDisabled]="'true'"></nz-input>
                  </div>
                </div>

                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="priority">优先级</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                      <pms-attribute-select formControlName="priority" group="common" code="priority" style="flex: 1 1 auto;"></pms-attribute-select>
                  </div>
                </div>

                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="estimate">预计工时</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                    <nz-input formControlName="estimate"></nz-input>
                  </div>
                </div>

                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="keywords">关键词</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                    <nz-input formControlName="keywords"></nz-input>
                  </div>
                </div>

                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="copyTo">抄送给</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                    <nz-input formControlName="copyTo"></nz-input>
                  </div>
                </div>

              </form>
            </div>
          </div>
          <!-- end card -->

          <div class="card mt-3">
            <div class="card-body">
              <h5 class="mb-2">需求的一生</h5>

              <form nz-form [formGroup]="requirementForm" [nzLayout]="'horizontal'">
                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="createdBy">创建者</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                    <a>{{requirement?.createdByDisplayName}}</a>
                  </div>
                </div>

                <div nz-form-item nz-row>
                  <div nz-form-label nz-col [nzSpan]="6">
                    <label for="">指派给</label>
                  </div>
                  <div nz-form-control nz-col [nzSpan]="16">
                    <pms-user-select formControlName="assignTo.id"></pms-user-select>
                  </div>
                </div>
              </form>
            </div>
          </div>
          <!-- end card -->

          <div class="card mt-3">
            <div class="card-body">
              <h5 class="mb-2">其他相关</h5>

              <div nz-form-item nz-row>
                <div nz-form-label nz-col [nzSpan]="6">
                    <label class="text-right">相关需求</label>
                </div>
                <div nz-form-control nz-col [nzSpan]="16">
                    <a>关联需求</a>
                </div>
              </div>
            </div>
          </div>
          <!-- end card -->
        </div>
        <div class="col order-1">
          <form nz-form [formGroup]="requirementForm">
              <div nz-form-item>
                  <div nz-form-control [nzHasFeedback]="'true'" [nzValidateStatus]="getFormControl('name')">
                    <nz-input formControlName="name" [nzPlaceHolder]="'请输入需求名称'" [nzSize]="'large'" [nzDisabled]="'true'"></nz-input>
                  </div>
              </div>

              <div nz-form-item class="mt-3">
                  <div nz-form-label>
                      <label for="description" nz-form-item-required>需求描述</label>
                  </div>
                  <div nz-form-control>
                      <nz-input formControlName="description" [nzType]="'textarea'" [nzRows]="'6'" [nzPlaceHolder]="'请输入需求描述'" [nzDisabled]="'true'"></nz-input>
                  </div>
              </div>

              <div nz-form-item class="mt-3">
                  <div nz-form-label>
                      <label for="acceptance">验收标准</label>
                  </div>
                  <div nz-form-control>
                      <nz-input formControlName="acceptance" [nzType]="'textarea'" [nzRows]="'4'" [nzPlaceHolder]="'请输入验收标准'" [nzDisabled]="'true'"></nz-input>
                  </div>
              </div>

              <div nz-form-item class="mt-3">
                  <div nz-form-label>
                      <label for="remark">备注</label>
                  </div>
                  <div nz-form-control>
                      <nz-input formControlName="remark" [nzType]="'textarea'" [nzRows]="'4'" [nzPlaceHolder]="'备注'"></nz-input>
                  </div>
              </div>

              <div nz-form-item class="mt-3">
                  <div nz-form-control class="text-center">
                    <button type="button" class="btn btn-primary" (click)="_save()">保存</button>
                    <button type="button" class="btn btn-light" (click)="_cancel()">取消</button>
                  </div>
              </div>
          </form>

          <div class="mt-4">
              <pms-requirement-change-log [requirementId]="requirement.id"></pms-requirement-change-log>
            </div>
        </div> <!-- end col -->
      </div> <!-- end row -->
    </ng-template>
  </nz-card>



</div>
